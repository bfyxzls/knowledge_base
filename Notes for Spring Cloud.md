分布式开发学习笔记之一
=
配置管理
-
#一. 基准代码
##1. 基准代码的定义：
基准代码在Git这样的分布式版本控制系统中指的是最上游的代码库，基准代码与应用之间一一对应，每个应用只对应一份基准代码，但可以同时存在多份部署，每份部署相当于运行了一个应用的实例。每个应用可以分别使用12-Factor开发。
##2. 应用部署原则：
一份基准代码，多份部署。
##3. 相同应用，不同部署
每份部署根据环境的不同（如：开发环境、生产环境等）使用的代码版本不同。
#二. 依赖
##1. 依赖声明
在12-Factor规则指导下，应用程序必须通过依赖清单显式声明所有依赖项（如：Intellij IDEA下使用Java开发，Maven作依赖管理工具时使用的pom.xml文件）。
##2. 依赖隔离
未声明的依赖项不可被调用。
##3. 显式依赖系统工具
这些被使用到的系统工具应当被显式包含在应用中。
#三. 配置
##1. 配置存储原则：
代码和配置严格分离。在环境中存储配置，而非在代码中存储。但应用的内部配置在不同部署间不存在差异，应写入代码。
##2. 用环境变量存储配置：
将应用配置存储与环境变量中，方便在不同部署间做修改却不动代码。
#四. 后端服务
##1. 后端服务（即资源）的定义：
后端服务是指程序运行所需要的通过网络调用的各种服务，如数据库、消息队列系统、缓存系统、SMTP邮件发送服务等等。
##2. 处理后端服务的原则：
应用不区别对待本地服务和第三方服务，这意味着当应用调用的某个服务需要由本地变更至第三方或相反时，仅需修改配置中的资源地址，无需修改代码，亦即资源和部署之间保持着松耦合。
##3. 后端服务和资源一一对应
两个MySQL数据库被当做两个不同资源。
#五. 构建、发布、运行
##1. 原则：
严格区分构建，发布，运行这三个步骤。
##2. 基准代码到部署（非开发环境）的过程（3个阶段）：
* 构建阶段：
指将代码仓库转化为可执行包的过程。构建时会使用指定版本的代码，获取和打包 依赖项，编译成二进制文件和资源文件。
* 发布阶段：
将构建的结果和当前部署所需 配置 相结合，并能够立刻在运行环境中投入使用。
* 运行阶段：
指针对选定的发布版本，在执行环境中启动一系列应用程序 进程。
##3. 自动发布运行（pipeline）：
新的代码在部署之前，需要开发人员触发构建操作。但是，运行阶段不一定需要人为触发，而是可以自动进行。
# 六. 进程
##重要特点：
无状态，无共享，任何需要持久化的数据都应存储在后端服务（如：数据库）中。本次请求中获得的数据不必为下一个请求保存。坚决反对“粘性session”。
#七. 端口绑定
##1. 容器的端口：
应用通常运行在容器中，而容器具备对外的端口，12-Factor应用通过端口绑定来提供服务。
##2. 智能路由和反向代理：
一个系统对外可能只会提供一个接口如（API Gateway），要想访问到系统中的某一个特定的微服务就需要用到端口映射的思想，即将外部端口映射为内部端口从而找到相应的微服务，也就是反向代理。
##3访问服务：
本地环境下，开发人员通过localhost加本地端口号访问服务；线上环境中，请求统一发送至公共域名而后路由至绑定了端口的网络进程。
#八. 并发
##1. 垂直扩展：
即加强一台独立机器的的性能，存在瓶颈。
##2. 水平扩展：
应用程序可以在多台物理机器间跨进程工作。
##3. 12-Factor应用在实现并发上的优势：

